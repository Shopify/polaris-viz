import {Meta, Story, Canvas} from '@storybook/addon-docs/blocks';

import {
  Divider,
  Title,
} from '../../../../polaris-viz/src/components/Docs/stories/components';

<Meta
  title="Shared/Utilities"
  parameters={{
    viewMode: 'docs',
    docsOnly: true,
  }}
/>

<Title>ðŸ›  Utilities</Title>

A collection of utility functions you can import either from `polaris-viz` or `polaris-viz-native`

<Divider noLine />

<Title type="h3">
  <code>createGradient()</code>
</Title>

<p>Returns a linear gradient from the provided colors.</p>

```tsx
const gradient = createGradient('red', 'green');

// [
//   {offset: 0, color: 'red'},
//   {offset: 100, color: 'green'},
// ]
```

<Divider />

<Title type="h3">
  <code>createTheme()</code>
</Title>

Returns a complete `Theme` from the `PartialTheme` provided.

See more details on the [createTheme Utility page](http://polaris-viz.shopify.io/?path=/docs/shared-themes-createtheme-utility--page)

<Divider />

<Title type="h3">
  <code>curveStepRounded()</code>
</Title>

<p>
  Apply a rounded curve to <code>d3-line</code> or <code>d3-shape</code>.
</p>

```tsx
const lineGenerator = line<DataPoint>()
  .x((_, index) => (xScale == null ? 0 : xScale(index)))
  .y(({value}) => yScale(value ?? 0));

// Apply a nice curve to each line point
generator.curve(curveStepRounded);
```

<Divider />

<Title type="h3">
  <code>getFilteredSeries()</code>
</Title>

<p>Return an array where all comparison data has been removed.</p>

```tsx
const DATA = [
  {
    data: [{key: 0, value: 100}],
  },
  {
    isComparison: true,
    data: [{key: 0, value: 200}],
  },
];

const series = getFilteredSeries(DATA);

// [
//   {
//     data: [{key: 0, value: 100}],
//   },
// ]
```

<Divider />

<Title type="h3">
  <code>getSeriesColors()</code>
</Title>

<p>
  In the theme definition, you can choose different colors to be displayed as
  <code>SeriesColors</code> depending on the amount of <code>DataSeries</code> being
  rendered. This function returns the colors array specified in the theme, according
  to the data series count.
</p>
<p>
  If a <code>DataSeries</code> count is higher the maximum amount of available
  colors, colors will repeat.
</p>
<p>
  Read more about how <code>SeriesColors</code> are used in the{' '}
  <code>Theme</code>
  <a hhref="https://polaris-viz.shopify.io/iframe.html?id=docs-themes-theme-definition--page&viewMode=docs&globals=outline:true&args=#titleAnchor-5">
    here
  </a>
</p>

```tsx
const seriesColors = getSeriesColors(1, 'Default');

// [
//   {
//     offset: 0,
//     color: '#7f4afa',
//   },
//   {
//     offset: 85,
//     color: '#3672bb',
//   },
//   {
//     offset: 100,
//     color: '#4b92e5',
//   },
// ]
```

<Divider />

<Title type="h3">
  <code>isGradientType()</code>
</Title>

<p>
  Returns a <code>boolean</code> based on if the provided color is a gradient or
  solid color.
</p>

```tsx
isGradientType([
  {offset: 0, color: 'red'},
  {offset: 100, color: 'green'},
]);

// true

isGradientType('red');

// false
```

<Divider />

<Title type="h3">
  <code>removeFalsyValues()</code>
</Title>

<p>
  Takes an object and returns a new object with all the falsy values removed.
</p>

```tsx
removeFalsyValues({
  foo: 'bar',
  number: 100,
  boolean: false,
  one: undefined,
  three: null,
});

// {
//   foo: 'bar',
//   number: 100,
//   boolean: false,
// }
```

<Divider />

<Title type="h3">
  <code>uniqueId()</code>
</Title>

<p>Returns a prefixed, auto-incremented string.</p>

```tsx
uniqueId('Pickle');

// Pickle-1

uniqueId('Pickle');

// Pickle-2
```

<Title type="h3">
  <code>paddingStringToObject()</code>
</Title>

<p>
  Converts a shorthand CSS padding string to a an object where each value is a
  padding side number. Units of measurement are disconsidered.
</p>

```tsx
paddingStringToObject('20px');

// {
//   paddingTop: 20,
//   paddingRight: 20,
//   paddingBottom: 20,
//   paddingLeft: 20,
// }

paddingStringToObject('50% 0');

// {
//   paddingTop: 50,
//   paddingRight: 0,
//   paddingBottom: 50,
//   paddingLeft: 0,
// }
```

<Title type="h3">
  <code>estimateStringWidth()</code>
</Title>

<p>
  Returns the approximate width of the provided string at <code>12px</code> font
  size.
</p>

```tsx
esimateStringWidth('Hello', characterWidths);

// 40
```

<Title type="h3">
  <code>clamp()</code>
</Title>

<p>Keep a number within a min/max bounds.</p>

```tsx
clamp({
  amount: 10,
  min: 15,
  max: 20,
});

// 15
```

<Title type="h3">
  <code>getValuesFromDataSeries()</code>
</Title>

<p>
  Returns an array of values mapped to keys provided in{' '}
  <code>DataSeries[].data</code>.
</p>

```tsx
const DATA: DataSeries[] = [
  {
    name: 'Breakfast',
    data: [
      {key: 'Monday', value: 3},
      {key: 'Tuesday', value: -7},
    ],
  },
  {
    name: 'Lunch',
    data: [
      {key: 'Monday', value: 4},
      {key: 'Tuesday', value: 0},
    ],
  },
  {
    name: 'Dinner',
    data: [
      {key: 'Monday', value: 7},
      {key: 'Tuesday', value: 0},
    ],
  },
];

const LABELS = ['Monday', 'Tuesday'];

getValuesFromDataSeries(DATA, LABELS);

// [[3, 4, 7], [-7, 0, 0]]
```

<Title type="h2">
  <code>Color Vision Events</code>
</Title>

Charts that include mouse/touch events include a11y events that bring focus to series that are currently being interacted with.

In order for these events to work we use `getColorVisionEventAttrs()` to add data-set attributes to elements in the chart.

One the chart is responding to our color vision events, we use `getColorVisionStylesForActiveIndex()` to apply the correct opacity to the different series in a chart.

<Title type="h3">
  <code>getColorVisionStylesForActiveIndex()</code>
</Title>

<p>Returns opacity styles for a current active index.</p>

```tsx
getColorVisionStylesForActiveIndex({index: 1, activeIndex: 1});

// {
//   opacity: '0.3',
//   transition: 'opacity 100ms ease',
// }
```

<Title type="h3">
  <code>getColorVisionEventAttrs()</code>
</Title>

<p>
  Returns an object of data-set attributes use to enable the color-vision events
  for an element.
</p>

```tsx
getColorVisionEventAttrs({type: 'single', index: 1});

// {
//   [`data-color-vision-event-watch`]: true,
//   [`data-color-vision-event-type`]: 'single',
//   [`data-color-vision-event-index`]: 1,
// }
```
